{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Search model</title>
    <!-- Bootstrap Core CSS -->
    <link href="{% static 'asset/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome CSS -->
    <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet">
    <!-- Animate CSS -->
    <link href="{% static 'css/animate.css' %}" rel="stylesheet">
    <!-- Owl-Carousel -->
    <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.transitions.css' %}">
    <!-- Custom CSS -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/responsive.css' %}" rel="stylesheet">
    <!-- Colors CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/green.css' %}">
    <!-- Colors CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/green.css' %}" title="green">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/light-red.css' %}" title="light-red">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/blue.css' %}" title="blue">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/light-blue.css' %}" title="light-blue">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/yellow.css' %}" title="yellow">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/light-green.css' %}" title="light-green">
    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <!-- Modernizer js -->
    <script src="js/modernizr.custom.js"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style>

        .search-container {
            text-align: center;
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }


        .search-box {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f1f1f1;
            padding: 10px;
            border-radius: 30px;
            width: 500px;
        }

        .search-box input {
            width: 80%;
            padding: 12px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
        }

        .search-box button {
            background-color: #abe0ff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.3s;
        }

        .search-box button:hover {
            background-color: #7ad6ff;
        }

        .search-container h1 {
            font-size: 30px;
            margin-bottom: 20px;
        }

        .result-container h1 {
            font-size: 30px;
            margin-bottom: 20px;
        }

        .centered-title {
            text-align: center;
            font-size: 28px;
            margin-bottom: 20px;
        }

        /* 样式化表格 */
        .protein-matrix {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        /* 表头样式 */
        .protein-matrix thead {
            background-color: #abe0ff;
            color: white;
        }

        /* 表格单元格样式 */
        .protein-matrix th, .protein-matrix td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        /* 行悬停效果 */
        .protein-matrix tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* 设置奇偶行不同背景色，增强可读性 */
        .protein-matrix tbody tr:nth-child(odd) {
            background-color: #f9f9f9;
        }

        .protein-matrix tbody tr:nth-child(even) {
            background-color: #ffffff;
        }

        /* 表格容器的内边距 */
        .result-container {
            padding: 20px;
            overflow-x: auto;
        }

        /* 响应式设计: 在屏幕小于600px时，表格宽度可自适应 */
        @media (max-width: 600px) {
            .protein-matrix {
                font-size: 14px;
            }

            .protein-matrix th, .protein-matrix td {
                padding: 8px;
            }
        }

    </style>


</head>


<body class="index">

<section id="page-top">
    <div id="main-slide" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner">
            <div class="item active">
                <img class="img-responsive" src="{% static 'img/enzyme3.jpg' %}" alt="slider">
                <div class="slider-content">
                    <div class="col-md-12 text-center">
                        <h1 class="animated3">
                            <span>搜索<strong>表征模型</strong></span>
                        </h1>
                        <p class="animated2">输入蛋白质序列，我们将会提供当前蛋白质的表征模型（矩阵）</p>
                        <a href="#search" class="page-scroll btn btn-primary animated1">GET STARTED</a>
                        <a href="#examples" class="page-scroll btn btn-primary animated1">LEARN MORE</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="search" class="serach" style="height: 240px;background-color: #e2ebff;">
    <div class="search-container">
        <h1>获取蛋白质的表征模型</h1>
        <div class="search-box">
            <input type="text" id="search-input" placeholder="请输入蛋白质序列...">
            <button onclick="search()">搜索</button>
        </div>
    </div>

</section>

<section id="result" class="result" style="height: auto;background-color: #e2ebff;">
    <div class="result-container">
        <h1 class="centered-title">搜索结果</h1>
        <div id="loadingMessage">正在加载数据...</div>
        <table id="proteinMatrix" class="protein-matrix" style="display: none;">
            <thead>
            <tr>
                <th>Feature Vector</th>
            </tr>
            </thead>
            <tbody>
            <!-- Dynamic rows will be inserted here -->
            </tbody>
        </table>
        <button id="showAllBtn" style="display: none;">显示全部</button>
    </div>
</section>

<section id="examples" class="latest-news-section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="section-title text-center">
                    <h3>搜索示例</h3>
                    <p>我们提供一些已完成的典型搜索结果，以便您快速学习如何使用酶挖掘功能</p>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="latest-news">
                <div class="col-md-12">
                    <div class="latest-post">
                        <img src="{% static 'images/about-01.jpg' %}" class="img-responsive" alt="">
                        <h4><a href="#">Image</a></h4>
                        <div class="post-details">
                            <span class="date"><strong>1</strong></span>
                        </div>
                        <p>结果1</p>
                        <a href="#" class="btn btn-primary">了解详情</a>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="latest-post">
                        <img src="{% static 'images/about-02.jpg' %}" class="img-responsive" alt="">
                        <h4><a href="#">Image</a></h4>
                        <div class="post-details">
                            <span class="date"><strong>2</strong></span>
                        </div>
                        <p>结果2</p>
                        <a href="#" class="btn btn-primary">了解详情</a>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="latest-post">
                        <img src="{% static 'images/about-03.jpg' %}" class="img-responsive" alt="">
                        <h4><a href="#">Image</a></h4>
                        <div class="post-details">
                            <span class="date"><strong>3</strong></span>
                        </div>
                        <p>结果3</p>
                        <a href="#" class="btn btn-primary">了解详情</a>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="latest-post">
                        <img src="{% static 'images/about-01.jpg' %}" class="img-responsive" alt="">
                        <h4><a href="#">Image</a></h4>
                        <div class="post-details">
                            <span class="date"><strong>4</strong></span>
                        </div>
                        <p>结果4</p>
                        <a href="#" class="btn btn-primary">了解详情</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- jQuery Version 2.1.1 -->
<script src="{% static 'js/jquery-2.1.1.min.js' %}"></script>

<!-- Bootstrap Core JavaScript -->
<script src="{% static 'asset/js/bootstrap.min.js' %}"></script>

<!-- Plugin JavaScript -->
<script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
<script src="{% static 'js/classie.js' %}"></script>
<script src="{% static 'js/count-to.js' %}"></script>
<script src="{% static 'js/jquery.appear.js' %}"></script>
<script src="{% static 'js/cbpAnimatedHeader.js' %}"></script>
<script src="{% static 'js/owl.carousel.min.js' %}"></script>
<script src="{% static 'js/jquery.fitvids.js' %}"></script>
<script src="{% static 'js/styleswitcher.js' %}"></script>

<!-- Contact Form JavaScript -->
<script src="{% static 'js/jqBootstrapValidation.js' %}"></script>
<script src="{% static 'js/contact_me.js' %}"></script>

<!-- Custom Theme JavaScript -->
<script src="{% static 'js/script.js' %}"></script>
<script>
    let featureVectors = [];
    let rowsToDisplay = 15;
    let currentRow = 0;

    // 搜索功能，发送请求到后端
    function search() {
        var query = document.getElementById('search-input').value;
        if (query.trim() !== "") {
            // 发送查询到后端 API
            fetch('/api/protein-embedding/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ sequence: query })
            })
            .then(response => response.json())
            .then(data => {
                if (data.embedding) {
                    console.log('搜索成功，返回数据：', data.embedding);
                    alert('搜索成功！');
                    displayEmbedding(data.embedding);
                } else {
                    alert('没有找到相关数据。');
                    console.error('没有返回有效的特征矩阵数据。');
                }
            })
            .catch(error => {
                console.error('发生错误:', error);
                alert('网络错误，请稍后再试。');
            });
        } else {
            alert("请输入蛋白质序列！");
        }
    }

    function displayEmbedding(embedding) {
        const table = document.querySelector('#proteinMatrix tbody');
        table.innerHTML = '';  // 清空表格内容
        const row = document.createElement('tr');

        embedding.forEach(value => {
            const cell = document.createElement('td');
            cell.textContent = value.toFixed(2);  // 保留两位小数
            row.appendChild(cell);
        });

        table.appendChild(row);
        document.getElementById('proteinMatrix').style.display = 'table';  // 显示表格
    }

    // 渲染表格数据
    function renderTable() {
        const tbody = document.querySelector('#proteinMatrix tbody');
        tbody.innerHTML = '';  // 清空当前表格内容

        for (let i = currentRow; i < currentRow + rowsToDisplay && i < featureVectors.length; i++) {
            const row = document.createElement('tr');
            featureVectors[i].forEach(value => {
                const cell = document.createElement('td');
                cell.textContent = value.toFixed(2); // 格式化数字保留两位小数
                row.appendChild(cell);
            });
            tbody.appendChild(row);
        }

        // 显示表格和“显示全部”按钮
        document.getElementById('proteinMatrix').style.display = 'table';
        document.getElementById('showAllBtn').style.display = 'block';
    }

    // 显示全部数据
    function showAll() {
        rowsToDisplay = featureVectors.length;
        renderTable();
        document.getElementById('showAllBtn').style.display = 'none';
    }

    // “显示全部”按钮事件
    document.getElementById('showAllBtn').addEventListener('click', showAll);

</script>


</body>

</html>
