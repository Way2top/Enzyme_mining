{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Search Enzyme Model</title>
    <!-- Bootstrap Core CSS -->
    <link href="{% static 'asset/css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Font Awesome CSS -->
    <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet">
    <!-- Animate CSS -->
    <link href="{% static 'css/animate.css' %}" rel="stylesheet">
    <!-- Owl-Carousel -->
    <link rel="stylesheet" href="{% static 'css/owl.carousel.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/owl.transitions.css' %}">
    <!-- Custom CSS -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/responsive.css' %}" rel="stylesheet">
    <!-- Colors CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/green.css' %}">
    <!-- Colors CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/green.css' %}" title="green">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/light-red.css' %}" title="light-red">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/blue.css' %}" title="blue">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/light-blue.css' %}" title="light-blue">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/yellow.css' %}" title="yellow">
    <link rel="stylesheet" type="text/css" href="{% static 'css/color/light-green.css' %}" title="light-green">
    <!-- Custom Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <!-- Modernizer js -->
    <script src="{% static 'js/modernizr.custom.js' %}"></script>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <script src="https://3dmol.csb.pitt.edu/build/3Dmol-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.2/3Dmol-min.js"></script>
    <![endif]-->

    <style>
        .page-scroll {
            font-size: 18px;
        }

        .navbar-default .nav li a {
            font-size: 14px !important;
        }

        #page-top {
            position: relative;
            height: 100vh;
            background-image: url('../../static/img/enzyme5.jpg');
            /* 设置背景图片 */
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            padding: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1;
        }

        #page-top .carousel-inner {
            position: relative;
            z-index: 10001;
        }

        #page-top .carousel-item {
            height: 100vh;
            /* 保证每个轮播项的高度为视口高度 */
        }

        #page-top .carousel-item img {
            object-fit: cover;
            /* 确保图片填充并保持比例 */
            height: 100%;
            /* 强制图片占满轮播项的高度 */
            width: 100%;
        }

        .search-container {
            text-align: center;
            background-color: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .function-container {
            display: flex;
            align-items: center;
            gap: 10px;
            /* 添加间距 */
            margin-top: 10px;
        }

        .search-box {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background-color: rgba(255, 255, 255, 0);
            padding: 10px;
            border-radius: 30px;
            width: 500px;
            opacity: 0;
            /* 初始状态隐藏 */
            transform: translateY(20px);
            /* 向下偏移，增加动画效果 */
            transition: opacity 1s ease-out, transform 1s ease-out;
        }

        .search-box input {
            width: 60%;
            padding: 12px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
        }

        .search-box button {
            background-color: #51b4ff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.3s;
        }

        .search-box button:hover {
            background-color: #1f8eff;
        }

        .search-container h1 {
            font-size: 30px;
            margin-bottom: 20px;
        }
        .result {
            background: linear-gradient(135deg, #e2ebff, #b0c7ff); /* 渐变背景色 */
            padding: 20px;
            border-radius: 12px; /* 增加圆角 */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1), 0 4px 16px rgba(0, 0, 0, 0.15); /* 更强烈的阴影效果 */
            transition: all 0.3s ease; /* 增加过渡效果 */
        }

        .result-container h1 {
            font-size: 30px;
            margin-bottom: 20px;
        }

        .centered-title {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #333;
            margin-bottom: 16px;
            padding-bottom: 8px;
            position: relative;
            display: inline-block;
            border-bottom: 2px solid #0b7ec4;
            /* 添加底部边框 */
        }


        /* 表格容器的内边距 */
        .result-title {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: auto;
        }

        .dropdown-menu li a {
            color: black !important;
        }

        .dropdown-menu li a:hover {
            color: #7ad6ff !important;
        }

        #loadingMessage {
            text-align: center;
            display: none;
            font-size: 18px;
        }


        /* 美化上传按钮 */
        #pdbFileInput {
            display: block;
            margin: 20px auto;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background-color: #4a90e2;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #pdbFileInput:hover {
            background-color: #357ABD;
        }

        #3dmolviewer_1741848665239376 {
            margin-top: 40px;
        }

        .viewer-card {
            position: relative;
            width: 640px;
            height: 480px;
            background: #e2dae3;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: box-shadow 0.3s ease, transform 0.2s ease;
            margin-top: 10px;
        }

        /* 悬停时增加阴影，提升层次感 */
        .viewer-card:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(-3px);
        }

        /* 隐藏原生文件上传按钮 */
        #pdbFileInput {
            display: none;
        }

        /* 自定义上传按钮 */
        .custom-file-upload {
            background-color: #51b4ff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        /* 鼠标悬停时变深色 */
        .custom-file-upload:hover {
            background-color: #357ABD;
        }

        /* Viewer container to unify 3D model and protein info */
        .viewer-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            /* Reduced gap between viewer and info */
            padding: 20px;
            background: #f8f9fd;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            margin: 0 30px 40px 30px;
        }

        /* 3D Viewer card */
        .viewer-card {
            position: relative;
            width: 1280px;
            height: 540px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: box-shadow 0.3s ease;
        }

        .viewer-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Protein info card */
        .protein-info-card {
            width: 1280px;
            /* Match the width of the viewer */
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            transition: box-shadow 0.3s ease;
        }

        .protein-info-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .protein-info-card h2 {
            font-size: 22px;
            color: #333;
            margin-bottom: 10px;
        }

        #proteinDetails {
            font-size: 16px;
            color: #555;
        }

        #proteinDetails h3::before,
        #proteinDetails p strong::before {
            margin-right: 5px;
        }

        .section-title {
            margin-bottom: 30px;
        }

        .content-section {
            /*padding: 50px 0;*/
        }

        .content-box {
            background: #ffffff;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .carousel img {
            border-radius: 10px;
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        h3 {
            color: #333;
            font-size: 22px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        p {
            font-size: 16px;
            line-height: 1.8;
        }

        strong {
            color: #333333;
        }
        /*
    .protein-info-card {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 10px;
    }
*/
    .protein-info-column {
        flex: 1;
        min-width: 18%; /* Ensures columns are flexible but don't shrink too much */
        padding: 10px;
        box-sizing: border-box;
    }

    .protein-info-column:not(:last-child) {
        border-right: 1px solid #dcdcdc; /* 淡灰色分割线 */
    }

    .protein-info-column h3 {
        margin-top: 0;
    }

    .protein-info-column p {
        margin: 5px 0;
    }
    </style>


</head>


<body class="index">

    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">Enzyme</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="{% url 'page1' %}">首页 </a>
                    </li>
                    <li><a class="page-scroll" href="{% url 'importdatabase' %}">导入蛋白质数据</a></li>
                    <li><a class="page-scroll" href="{% url 'page2' %}">表征模型</a></li>
                    <li><a class="page-scroll" href="{% url 'similarenzyme' %}">酶挖掘</a></li>
                    <li><a class="page-scroll" href="{% url 'dataanalysis' %}">蛋白质信息可视化</a></li>
                    <li><a class="page-scroll" href="{% url 'enzymemodel' %}">蛋白质3D模型</a></li>
                    <li><a class="page-scroll" href="{% url 'about' %}">蛋白质数据库</a></li>


                    <li>
                        <a href="http://127.0.0.1:8000/admin_ls/" style="margin-left: 30px;">管理员登录</a>
                    </li>
                </ul>

            </div>
        </div>
    </nav>


    <section id="page-top">
        <div id="main-slide" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                <div class="item active">
                    <div class="slider-content">
                        <div class="col-md-12 text-center"
                            style="display: flex; flex-direction: column; align-items: center;">
                            <h1 class="animated3">
                                <span>搜索<strong>蛋白质3D模型</strong></span>
                            </h1>
                            <p class="animated2">输入蛋白质的模型编号，我们将会提供您酶的3D模型</p>
                            <div class="function-container">
                                <div class="search-box">
                                    <input type="text" id="search-input" placeholder="请输入蛋白质模型编号..."












                                           
                                        style="color: black;">

                                    <button id="search-button" style="margin-left: 15px;display: none">搜索</button>

                                    <button id="download-button" style="margin-left: 15px;">下载</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--
<section id="result" class="result" style="height: auto;background-color: #e2ebff;">
    <div class="result-container">
        <div class="result-title">
            <h1 class="centered-title">3D模型可视化</h1>
            <div id="loadingMessage">正在加载...</div>
            <label for="pdbFileInput" class="custom-file-upload">请选择上传文件（.pdb）</label>
            <input type="file" id="pdbFileInput" accept=".pdb">
        </div>
        <div class="row" style="display: flex;justify-content: space-between;align-items: flex-start;">
            <div class="col-md-6" style="margin: 10px 30px 40px 40px;">
                <div id="3dmolviewer_1741848665239376" class="viewer-card"
                     style="position: relative; width: 640px; height: 480px;">
                </div>
            </div>
            <div class="col-md-6 protein-info">
                <h2>蛋白质信息</h2>
                <div id="proteinDetails">请输入 PDB 编号并搜索</div>
            </div>
        </div>
    </div>
</section>
-->

    <section id="result" class="result"
        style="height: auto; background-image: url('images/parallax/bg-01.jpg'); padding-bottom: 20px;">
        <div class="result-container" style="height: auto;">
            <div class="result-title">
                <h1 class="centered-title" style="">3D模型可视化</h1>
                <div id="loadingMessage">正在加载...</div>
                <label for="pdbFileInput" class="custom-file-upload">请选择上传文件（.pdb）</label>
                <input type="file" id="pdbFileInput" accept=".pdb">
            </div>
            <div class="viewer-container">
                <div class="viewer-card" id="3dmolviewer_1741848665239376"></div>
                <div class="protein-info-card">

                    <div id="proteinDetails">请输入 PDB 编号并搜索</div>
                </div>
            </div>
        </div>
    </section>

    <div id="introduction" class="content-section">
        <div class="container">
            <div class="section-title text-center">
                <h3 style="font-size: 26px; font-weight: bold; color: #333;
                               text-transform: uppercase; border-bottom: 2px solid #007bff;
                               display: inline-block; padding-bottom: 10px;">
                    功能介绍
                </h3>
            </div>

            <div class="row align-items-center mb-5">
                <div class="col-md-6">
                    <div class="content-box">
                        <h3>蛋白质的3D模型的组成信息</h3>
                        <p style="font-size: 14px;text-align: justify;">
                        蛋白质的三维结构模型主要基于 X
                        射线晶体学、冷冻电子显微镜或核磁共振等实验数据生成，或由 AI 预测
                        <br><strong>1.原子坐标: </strong>3D模型记录了蛋白质每个原子的空间坐标（x,
                        y, z），定义了蛋白质的结构，包括主链（骨架）和侧链的精确排布。
                        <br><strong>2.二级结构:</strong>
                        α-螺旋：螺旋状结构，由氢键稳定。
                        β-折叠：片层结构，由平行或反平行的 β 链组成。
                        无规卷曲：无固定形态的区域，通常用于连接二级结构。
                        <br><strong>3.三级结构:</strong>
                        蛋白质在3D空间中的完整折叠状态，由氢键、疏水作用、离子键、范德华力等稳定。
                        <br><strong>4.四级结构:</strong>
                        由多个蛋白质亚基组成的复合体，如血红蛋白由四个亚基组成。
                        <br><strong>5.活性位点: </strong>包含催化作用或分子结合的关键氨基酸
                        <br><strong>6.配体、辅因子、金属离子:</strong>
                        配体：指能与蛋白质结合的小分子，如 ATP、抑制剂或底物。
                        辅因子：如金属离子或辅酶，这些分子对蛋白质功能至关重要。
                        <br><strong>7.动态信息: </strong>通过分子动力学模拟可观察蛋白质在不同环境下的运动
                    </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="carousel-container">
                        <div id="carousel-sequence" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item active" style="margin-top: 15px;">
                                    <img src="../../static/img/enzyme9.png" alt="蛋白质序列">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row align-items-center" style="margin-top: 20px;">
                <div class="col-md-6">
                    <div class="carousel-container">
                        <div id="carousel-model" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item active" style="margin-top: 50px;">
                                    <img src="../../static/img/enzyme19.png" alt="表征模型">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="content-box" style="margin-top: 40px;">
                        <h3>蛋白质3D模型的作用</h3>
                        <p style="font-size: 14px;text-align: justify;">
                        <strong>1.结构与功能研究: </strong>通过蛋白质的3D模型，研究人员可以解析其功能。例如：
                        酶的催化机制：研究酶如何降低化学反应的活化能。
                        蛋白质-蛋白质相互作用：研究细胞信号传导路径，如 G 蛋白偶联受体如何传递信号。
                        <br><strong>2.药物设计与研发: </strong>结构生物学是
                        计算机辅助药物设计的核心：
                        分子对接：模拟小分子药物如何与靶标蛋白结合，提高药物设计效率。
                        理性药物设计：优化药物分子，使其更高效、更专一地作用于靶蛋白。
                        <br><strong>3.疾病研究:</strong>
                        许多疾病（如阿尔茨海默病、帕金森病）与蛋白质异常折叠有关。3D模型可用于研究：
                        蛋白错误折叠（如β淀粉样蛋白在阿尔茨海默病中的聚集）。
                        遗传突变的影响（如 CFTR 突变导致囊性纤维化）。
                        <br><strong>4.合成生物学与蛋白质工程:</strong>
                        3D结构可用于设计人工蛋白质，如：
                        酶工程：改造酶结构以提高催化效率或改变底物特异性。
                        蛋白质纳米技术：设计新的蛋白质材料或药物载体。
                    </p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <section id="examples" class="latest-news-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="section-title text-center">
                        <h3 style="font-size: 26px; font-weight: bold; color: #333;
                               text-transform: uppercase; border-bottom: 2px solid #007bff;
                               display: inline-block; padding-bottom: 10px;">搜索示例</h3>
                        <p>我们提供一些典型的搜索结果，以便您快速学习如何使用功能</p>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="latest-news">
                    <div class="col-md-12">
                        <div class="latest-post">
                            <img src="{% static 'img/step4.1.png' %}" class="img-responsive" alt="">
                            <div class="post-details">
                                <span class="date">1</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="latest-post">
                            <img src="{% static 'img/step4.2.png' %}" class="img-responsive" alt="">
                            <div class="post-details">
                                <span class="date">2</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="latest-post">
                            <img src="{% static 'img/step4.3.png' %}" class="img-responsive" alt="">
                            <div class="post-details">
                                <span class="date">3</span>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- jQuery Version 2.1.1 -->
    <script src="{% static 'js/jquery-2.1.1.min.js' %}"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="{% static 'asset/js/bootstrap.min.js' %}"></script>

    <!-- Plugin JavaScript -->
    <script src="{% static 'js/jquery.easing.1.3.js' %}"></script>
    <script src="{% static 'js/classie.js' %}"></script>
    <script src="{% static 'js/count-to.js' %}"></script>
    <script src="{% static 'js/jquery.appear.js' %}"></script>
    <script src="{% static 'js/cbpAnimatedHeader.js' %}"></script>
    <script src="{% static 'js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'js/jquery.fitvids.js' %}"></script>
    <script src="{% static 'js/styleswitcher.js' %}"></script>

    <!-- Contact Form JavaScript -->
    <script src="{% static 'js/jqBootstrapValidation.js' %}"></script>
    <script src="{% static 'js/contact_me.js' %}"></script>

    <!-- Custom Theme JavaScript -->
    <script src="{% static 'js/script.js' %}"></script>
    <!--
<script>
    document.getElementById('search-button').addEventListener('click', function() {
        let proteinId = document.getElementById('search-input').value.trim();
        if (!proteinId) {
            alert("请输入蛋白质编号！");
            return;
        }

        let loadingMessage = document.getElementById('loadingMessage');
        loadingMessage.style.display = "block"; // 显示加载信息

        // 假设后端 API 是 /api/getProteinModel?proteinId=XXX
        fetch(`/api/getProteinModel?proteinId=${proteinId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("网络错误或数据未找到");
                }
                return response.text(); // 服务器返回的是 PDB 格式的文本数据
            })
            .then(pdbData => {
                loadingMessage.style.display = "none"; // 隐藏加载信息
                renderProteinModel(pdbData);
            })
            .catch(error => {
                loadingMessage.style.display = "none";
                alert("获取数据失败: " + error.message);
            });
    });

    function renderProteinModel(pdbData) {
        let viewerElement = document.getElementById("viewer");
        viewerElement.innerHTML = ""; // 清空之前的内容

        let viewer = $3Dmol.createViewer(viewerElement, {
            defaultcolors: $3Dmol.rasmolElementColors
        });

        viewer.addModel(pdbData, "pdb"); // 加载 PDB 数据
        viewer.setStyle({}, { cartoon: { color: 'spectrum' } }); // 设定显示样式
        viewer.zoomTo(); // 自动调整视角
        viewer.render(); // 渲染模型
    }
</script>
-->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(function () {
                let searchBox = document.querySelector(".search-box");
                searchBox.style.opacity = "1";
                searchBox.style.transform = "translateY(0)"; // 复位动画
            }, 500); // 500ms 后执行动画
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            setTimeout(function () {
                let searchBox = document.querySelector(".custom-file-upload");
                searchBox.style.opacity = "1";
                searchBox.style.transform = "translateY(0)"; // 复位动画
            }, 500); // 500ms 后执行动画
        });
    </script>
    <script>
        document.getElementById("download-button").addEventListener("click", function () {
            let proteinId = document.getElementById("search-input").value.trim();
            if (proteinId === "") {
                alert("请输入蛋白质的PDB编号！");
                return;
            }

            // PDB 文件的下载地址 (RCSB PDB)
            let pdbUrl = `https://files.rcsb.org/download/${proteinId}.pdb`;

            // 创建隐藏的 a 标签并自动触发下载
            let a = document.createElement("a");
            a.href = pdbUrl;
            a.download = `${proteinId}.pdb`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
    </script>

    <script>
        document.getElementById("search-button").addEventListener("click", function () {
            let input = document.getElementById("search-input").value.trim().toUpperCase();
            if (input === "") {
                alert("请输入蛋白质的 PDB 编号");
                return;
            }

            let pdbId = input; // Assuming input is a PDB ID like "1O86"
            let pdbUrl = `https://files.rcsb.org/download/${pdbId}.pdb`;
            let viewerDiv = document.getElementById("3dmolviewer_1741848665239376");
            viewerDiv.innerHTML = ""; // Clear previous 3D view
            let loadingMessage = document.getElementById("loadingMessage");
            let proteinDetails = document.getElementById("proteinDetails");

            loadingMessage.style.display = "block"; // Show loading message
            proteinDetails.innerHTML = "正在获取蛋白质信息..."; // Show loading info

            // Initialize 3Dmol viewer
            let viewer = $3Dmol.createViewer(viewerDiv, { backgroundColor: "white" });

            // Load PDB 3D structure
            viewer.addModelFromURL(pdbUrl, "pdb", function () {
                viewer.setStyle({}, { cartoon: { color: "spectrum" } });
                viewer.zoomTo();
                viewer.render();
                loadingMessage.style.display = "none"; // Hide loading message
            }, function (error) {
                alert("加载失败，请检查 PDB 编号是否正确！");
                loadingMessage.style.display = "none";
                proteinDetails.innerHTML = "未找到蛋白质信息，请检查 PDB 编号是否正确！";
            });

            // Simulate backend data retrieval based on PDB ID
            fetchProteinInfo(pdbId, proteinDetails);
        });

        // Function to fetch protein info from backend API
        function fetchProteinInfo(pdbId, proteinDetails) {
            const apiUrl = `https://your-backend.com/api/protein/${pdbId}`; // Replace with your actual API endpoint

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("API request failed");
                    }
                    return response.json();
                })
                .then(data => {
                    // Format the protein info based on the API response
                    let infoHtml = `
                    <div class="protein-info-column">
                        <h3>📌 基本信息</h3>
                        <p><strong>📌 PDB ID:</strong> ${data.basicInfo.pdbId || "N/A"}</p>
                        <p><strong>🔄 UniProt ID:</strong> ${data.basicInfo.uniProtId || "N/A"}</p>
                        <p><strong>🔬 分子类型:</strong> ${data.basicInfo.moleculeType || "N/A"}</p>
                        <p><strong>链信息:</strong> ${data.basicInfo.chain || "N/A"}</p>
                    </div>
                    <div class="protein-info-column">
                        <h3>📊 结构参数</h3>
                        <p><strong>📊 残基数量:</strong> ${data.structureParams.residueCount || "N/A"}</p>
                        <p><strong>分子量:</strong> ${data.structureParams.molecularWeight || "N/A"}</p>
                    </div>
                    <div class="protein-info-column">
                        <h3>🧬 蛋白质信息</h3>
                        <p><strong>🧬 名称:</strong> ${data.proteinInfo.name || "N/A"}</p>
                        <p><strong>基因:</strong> ${data.proteinInfo.gene || "N/A"}</p>
                    </div>
                    <div class="protein-info-column">
                        <h3>🌱 来源与制备</h3>
                        <p><strong>🌱 物种:</strong> ${data.sourcePreparation.species || "N/A"}</p>
                        <p><strong>表达系统:</strong> ${data.sourcePreparation.expressionSystem || "N/A"}</p>
                        <p><strong>制备方式:</strong> ${data.sourcePreparation.preparationMethod || "N/A"}</p>
                    </div>
                    <div class="protein-info-column">
                        <h3>🔄 序列信息</h3>
                        <p><strong>🔄 序列区间:</strong> ${data.sequenceInfo.range || "N/A"}</p>
                        <p><strong>完整序列（前20字符）:</strong> ${data.sequenceInfo.sequencePreview || "N/A"}</p>
                    </div>
                `;
                    proteinDetails.innerHTML = infoHtml;
                })
                .catch(error => {
                    console.error("Error fetching protein info:", error);
                    proteinDetails.innerHTML = "未找到蛋白质信息，请检查 PDB 编号是否正确或联系管理员！";
                });
        }
    </script>

    <script>
        var loadScriptAsync = function (uri) {
            return new Promise((resolve, reject) => {
                var savedexports, savedmodule;
                if (typeof exports !== 'undefined') savedexports = exports;
                else exports = {};
                if (typeof module !== 'undefined') savedmodule = module;
                else module = {};

                var tag = document.createElement('script');
                tag.src = uri;
                tag.async = true;
                tag.onload = () => {
                    exports = savedexports;
                    module = savedmodule;
                    resolve();
                };
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            });
        };

        if (typeof $3Dmolpromise === 'undefined') {
            $3Dmolpromise = loadScriptAsync('https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.4.2/3Dmol-min.js');
        }

        $3Dmolpromise.then(function () {
            var viewer = $3Dmol.createViewer(document.getElementById("3dmolviewer_1741848665239376"), { backgroundColor: "white" });
            var tooltip = document.createElement("div");
            tooltip.style.position = "absolute";
            tooltip.style.display = "none";
            tooltip.style.background = "rgba(0,0,0,0.8)";
            tooltip.style.color = "white";
            tooltip.style.padding = "8px";
            tooltip.style.borderRadius = "5px";
            tooltip.style.fontSize = "14px";
            tooltip.style.pointerEvents = "none";
            tooltip.style.zIndex = "1000";
            document.body.appendChild(tooltip);

            var loadingMessage = document.getElementById("loadingMessage");
            var proteinDetails = document.getElementById("proteinDetails");

            // Search button functionality
            document.getElementById("search-button").addEventListener("click", function () {
                let input = document.getElementById("search-input").value.trim().toUpperCase();
                if (input === "") {
                    alert("请输入蛋白质的 PDB 编号");
                    return;
                }

                let pdbId = input;
                let pdbUrl = `https://files.rcsb.org/download/${pdbId}.pdb`;
                viewer.clear();
                loadingMessage.style.display = "block";
                proteinDetails.innerHTML = "正在获取蛋白质信息...";

                viewer.addModelFromURL(pdbUrl, "pdb", function () {
                    viewer.setStyle({}, { cartoon: { color: "spectrum" } });
                    viewer.zoomTo();
                    viewer.render();
                    loadingMessage.style.display = "none";
                }, function (error) {
                    alert("加载 3D 模型失败，请检查 PDB 编号是否正确！");
                    loadingMessage.style.display = "none";
                });

                fetchProteinInfo(pdbId, proteinDetails);
            });

            // PDB file upload functionality
            document.getElementById('pdbFileInput').addEventListener('change', function (event) {
                var file = event.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var pdbData = e.target.result;
                        viewer.clear();
                        loadingMessage.style.display = "block";
                        proteinDetails.innerHTML = "正在获取蛋白质信息...";

                        var model = viewer.addModel(pdbData, "pdb");
                        viewer.setStyle({}, { stick: {} });
                        viewer.zoomTo();
                        viewer.zoom(1.4);
                        viewer.render();
                        loadingMessage.style.display = "none";

                        // Extract PDB ID from filename (e.g., "1O86.pdb" -> "1O86")
                        var pdbId = file.name.replace(/\.pdb$/i, "").toUpperCase();
                        fetchProteinInfo(pdbId, proteinDetails);

                        // Add hover functionality
                        viewer.setHoverable({}, true, function (atom, viewer, event, container) {
                            if (atom && atom.resn) {
                                tooltip.innerHTML = `Residue: ${atom.resn} ${atom.resi}<br>Chain: ${atom.chain}`;
                                tooltip.style.left = `${event.clientX + 15}px`;
                                tooltip.style.top = `${event.clientY + 15}px`;
                                tooltip.style.display = "block";
                            }
                        }, function () {
                            tooltip.style.display = "none";
                        });
                    };
                    reader.readAsText(file);
                }
            });

            // Tooltip movement
            document.addEventListener("mousemove", function (event) {
                if (tooltip.style.display === "block") {
                    tooltip.style.left = `${event.clientX + 15}px`;
                    tooltip.style.top = `${event.clientY + 15}px`;
                }
            });
        });

        function fetchProteinInfo(pdbId, proteinDetails) {
            console.log('pdbId', pdbId);
            const apiUrl = `https://www.ebi.ac.uk/pdbe/api/pdb/entry/molecules/${pdbId.toLowerCase()}`;

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) throw new Error("API请求失败");
                    return response.json();
                })
                .then(data => {
                    console.log('API返回数据:', data);
                    const molecules = data[pdbId.toLowerCase()]; // 获取对应PDB ID的分子数组

                    // 检查分子数据是否存在
                    if (!molecules || molecules.length === 0) {
                        proteinDetails.innerHTML = "未找到蛋白质信息，请检查PDB ID！";
                        return;
                    }

                    // 查找第一个蛋白质实体（polypeptide(L)类型）
                    const molecule = molecules.find(mol => mol.molecule_type === 'polypeptide(L)');
                    if (!molecule) {
                        proteinDetails.innerHTML = "该结构未包含蛋白质实体！";
                        return;
                    }

                    // 并行获取UniProt ID
                    const uniprotUrl = `https://www.ebi.ac.uk/pdbe/api/pdb/entry/uniprot/${pdbId.toLowerCase()}`;
                    return Promise.all([
                        molecule,
                        fetch(uniprotUrl)
                            .then(res => res.ok ? res.json() : null)
                            .catch(() => null)
                    ]);
                })
                .then(([molecule, uniprotData]) => {
                    // 解析UniProt ID
                    let uniprotId = 'N/A';
                    if (uniprotData && uniprotData[pdbId.toLowerCase()]) {
                        const uniprotKeys = Object.keys(uniprotData[pdbId.toLowerCase()].UniProt || {});
                        if (uniprotKeys.length > 0) {
                            uniprotId = uniprotKeys[0].split('|')[0];
                        }
                    }

                    // 处理嵌套数据结构
                    const source = molecule.source?.[0] || {};
                    const mappings = source.mappings?.[0] || {};

                    // 构建HTML信息
                    const infoHtml = `
                    <div style="display: flex; flex-wrap: wrap; gap: 20px; font-family: Arial, sans-serif; color: #333;">
                        <!-- 基本信息 -->
                        <div class="protein-info-column" le="flex: 1 1 200px; min-width: 200px;">
                            <h3 style="color: #0066cc; margin-bottom: 10px;">📌 基本信息</h3>
                            <p><strong>PDB ID:</strong> ${pdbId}</p>
                            <p><strong>UniProt ID:</strong> ${uniprotId}</p>
                            <p><strong>分子类型:</strong> ${molecule.molecule_type || 'N/A'}</p>
                            <p><strong>链:</strong> ${molecule.in_chains?.join(', ') || 'N/A'}</p>
                        </div>

                        <!-- 结构参数 -->
                        <div class="protein-info-column" style="flex: 1 1 200px; min-width: 200px;">
                            <h3 style="color: #28a745; margin-bottom: 10px;">📊 结构参数</h3>
                            <p><strong>残基数量:</strong> ${molecule.length || 'N/A'}</p>
                            <p><strong>分子量:</strong> ${molecule.weight ? `${molecule.weight.toFixed(1)} kDa` : 'N/A'}</p>
                        </div>

                        <!-- 蛋白质信息 -->
                        <div class="protein-info-column" style="flex: 1 1 200px; min-width: 200px;">
                            <h3 style="color: #ff6347; margin-bottom: 10px;">🧬 蛋白质信息</h3>
                            <p><strong>名称:</strong> ${molecule.molecule_name?.join(', ') || 'N/A'}</p>
                            <p><strong>基因:</strong> ${molecule.gene_name?.join(', ') || 'N/A'}</p>
                        </div>

                        <!-- 来源与制备 -->
                        <div class="protein-info-column" style="flex: 1 1 200px; min-width: 200px;">
                            <h3 style="color: #ffc107; margin-bottom: 10px;">🌱 来源与制备</h3>
                            <p><strong>物种:</strong> ${source.organism_scientific_name || 'N/A'}</p>
                            <p><strong>表达系统:</strong> ${source.expression_host_scientific_name || 'N/A'}</p>
                            <p><strong>制备方式:</strong> ${molecule.sample_preparation || 'N/A'}</p>
                        </div>

                        <!-- 序列信息 -->
                        <div class="protein-info-column" style="flex: 1 1 200px; min-width: 200px;">
                            <h3 style="color: #17a2b8; margin-bottom: 10px;">🔄 序列信息</h3>
                            <p><strong>序列区间:</strong> ${mappings.start?.residue_number || 'N/A'}-${mappings.end?.residue_number || 'N/A'}</p>
                            <p><strong>部分序列:</strong> ${molecule.pdb_sequence?.slice(0, 20) || 'N/A'}...</p>
                        </div>
                    </div>
                    `;

                    proteinDetails.innerHTML = infoHtml;
                })
                .catch(error => {
                    console.error('数据获取失败:', error);
                    proteinDetails.innerHTML = "信息加载失败，请检查网络或PDB ID！";
                });
        }


    </script>

</body>

</html>